jQuery.extend({createUploadIframe:function(e,c){var b="jUploadFrame"+e;if(window.ActiveXObject){var a=jQuery.browser.version;if(a.match(/^(6|7)/)){var d=document.createElement('<iframe id="'+b+'" name="'+b+'" />')}else{var d=document.createElement("iframe");d.id=b;d.name=b}if(typeof c=="boolean"){d.src="javascript:false"}else{if(typeof c=="string"){d.src=c}}}else{var d=document.createElement("iframe");d.id=b;d.name=b}d.style.position="absolute";d.style.top="-1000px";d.style.left="-1000px";document.body.appendChild(d);return d},createUploadForm:function(h,b,e){var f="jUploadForm"+h;var a="jUploadFile"+h;var d=$('<form  action="" method="POST" name="'+f+'" id="'+f+'" enctype="multipart/form-data"></form>');$.each(e,function(i,j){var k=$('<input type="hidden" value="" id="'+i+'" name="'+i+'" />');$(k).val(j);$(k).appendTo(d)});var c=$("#"+b);var g=$(c).clone();$(c).attr("id",a);$(c).before(g);$(c).appendTo(d);$(d).css("position","absolute");$(d).css("top","-1200px");$(d).css("left","-1200px");$(d).appendTo("body");return d},ajaxFileUpload:function(s){s=jQuery.extend({},jQuery.ajaxSettings,s);var id=new Date().getTime();var form=jQuery.createUploadForm(id,s.fileElementId,s.data);var io=jQuery.createUploadIframe(id,s.secureuri);var frameId="jUploadFrame"+id;var formId="jUploadForm"+id;if(s.global&&!jQuery.active++){jQuery.event.trigger("ajaxStart")}var requestDone=false;var response;if(s.global){jQuery.event.trigger("ajaxSend",[response,s])}var uploadCallback=function(isTimeout){var io=document.getElementById(frameId);try{if(io.contentWindow){response=io.contentWindow.document.body?io.contentWindow.document.body.innerHTML:null}else{if(io.contentDocument){response=io.contentDocument.document.body?io.contentDocument.document.body.innerHTML:null}}}catch(e){jQuery.handleError(s,response,null,e)}if(response||isTimeout=="timeout"){requestDone=true;var status;try{status=isTimeout!="timeout"?"success":"error";if(status!="error"){var data=eval("data = "+Base64.decode(response));if(s.success){s.success(data,status)}if(s.global){jQuery.event.trigger("ajaxSuccess",[response,s])}}else{jQuery.handleError(s,response,status)}}catch(e){status="error";jQuery.handleError(s,response,status,e)}if(s.global){jQuery.event.trigger("ajaxComplete",[response,s])}if(s.global&&!--jQuery.active){jQuery.event.trigger("ajaxStop")}if(s.complete){s.complete(response,status)}jQuery(io).unbind();setTimeout(function(){try{$(io).remove();$(form).remove()}catch(e){jQuery.handleError(s,response,null,e)}},100);response=null}};if(s.timeout>0){setTimeout(function(){if(!requestDone){uploadCallback("timeout")}},s.timeout)}try{var form=$("#"+formId);$(form).attr("action",s.url);$(form).attr("method","POST");$(form).attr("target",frameId);if(form.encoding){form.encoding="multipart/form-data"}else{form.enctype="multipart/form-data"}$(form).submit()}catch(e){jQuery.handleError(s,response,null,e)}if(window.attachEvent){document.getElementById(frameId).attachEvent("onload",uploadCallback)}else{document.getElementById(frameId).addEventListener("load",uploadCallback,false)}return{abort:function(){}}},handleError:function(b,d,a,c){if(b.error){b.error.call(b.context||window,d,a,c)}if(b.global){(b.context?jQuery(b.context):jQuery.event).trigger("ajaxError",[d,b,c])}}});